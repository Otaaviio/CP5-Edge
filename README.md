# üç∑ Sistema IoT de Monitoramento de Adega Climatizada

<div align="center">

![ESP32](https://img.shields.io/badge/ESP32-000000?style=for-the-badge&logo=espressif&logoColor=white)
![AWS](https://img.shields.io/badge/AWS-232F3E?style=for-the-badge&logo=amazon-aws&logoColor=white)
![MQTT](https://img.shields.io/badge/MQTT-660066?style=for-the-badge&logo=mqtt&logoColor=white)
![FIWARE](https://img.shields.io/badge/FIWARE-FF7139?style=for-the-badge&logo=fiware&logoColor=white)
![Docker](https://img.shields.io/badge/Docker-2496ED?style=for-the-badge&logo=docker&logoColor=white)

_Sistema completo de monitoramento e controle para adegas climatizadas utilizando IoT e FIWARE_

</div>

---

## üìã Sobre o Projeto

Este projeto implementa um **sistema completo de monitoramento IoT** para adegas climatizadas, utilizando o microcontrolador **ESP32** para coletar dados ambientais e transmiti-los para uma infraestrutura em nuvem baseada na plataforma **FIWARE** hospedada na **AWS**.

### ‚ú® Funcionalidades Principais

| Funcionalidade                  | Descri√ß√£o                                                |
| ------------------------------- | -------------------------------------------------------- |
| üå°Ô∏è **Temperatura**              | Monitoramento em tempo real via sensor DHT22             |
| üíß **Umidade**                  | Controle da umidade ideal para conserva√ß√£o de vinhos     |
| üí° **Luminosidade**             | Medi√ß√£o atrav√©s de sensor LDR (Light Dependent Resistor) |
| üîÑ **Comunica√ß√£o Bidirecional** | Controle remoto do LED via protocolo MQTT                |
| ‚òÅÔ∏è **Cloud Computing**          | Dados processados e armazenados em infraestrutura AWS    |
| üì± **Acesso Mobile**            | Visualiza√ß√£o e controle pelo aplicativo MyMQTT           |
| üê≥ **Arquitetura FIWARE**       | Uso de componentes Orion, STH-Comet e MongoDB            |

---

## üèóÔ∏è Arquitetura do Sistema

### üìê Componentes da Arquitetura

#### **Camada de Aplica√ß√£o**

- **Mobile**: Aplicativo MyMQTT para controle remoto
- **BigData**: An√°lise de grandes volumes de dados hist√≥ricos

#### **Camada de Backend (Docker)**

- **Orion Context Broker** (Porta 1026): Gerenciamento de contexto em tempo real
- **STH-Comet** (Porta 8666): Armazenamento de dados hist√≥ricos
- **MongoDB** (Porta 27017): Banco de dados NoSQL
- **IoT Agent MQTT** (Porta 4041): Ponte entre dispositivos MQTT e FIWARE

#### **Camada IoT**

- **MQTT Broker** (Porta 1883): Servidor Mosquitto para comunica√ß√£o
- **ESP32**: Microcontrolador com sensores DHT22, LDR e LED
- **Sensores**: Capta√ß√£o de dados ambientais
- **Atuadores**: Controle do LED para feedback visual

### üîÑ Fluxo de Dados

<p align="center">
  <img src="./arquitetura.png" alt="Arquitetura do Projeto" style="width:400px;"/>
</p>

---

## üîß Recursos Necess√°rios

### Hardware (Simulado no Wokwi)

- ESP32
- Sensor DHT22 (Temperatura e Umidade)
- Sensor LDR (Luminosidade)
- LED
- Resistores (10kŒ© para LDR e 330Œ© para LED)

### Software e Servi√ßos

- **Wokwi**: Simulador online de ESP32
- **AWS EC2**: M√°quina virtual na nuvem
- **Docker & Docker Compose**: Containeriza√ß√£o dos servi√ßos FIWARE
- **Postman**: Testes e configura√ß√£o da API FIWARE
- **MyMQTT**: Aplicativo mobile (Android/iOS)

---

## üöÄ Guia de Configura√ß√£o

### Passo 1: Configurar o Circuito no Wokwi

#### üîå Tabela de Conex√µes

| Componente              | Pino ESP32                 | Observa√ß√µes                      |
| ----------------------- | -------------------------- | -------------------------------- |
| **DHT22**               |                            |                                  |
| VCC                     | 3.3V                       | Alimenta√ß√£o                      |
| GND                     | GND                        | Terra                            |
| DATA                    | GPIO 4                     | Leitura de temperatura e umidade |
| **LDR (Sensor de Luz)** |                            |                                  |
| Terminal 1              | 3.3V                       | Alimenta√ß√£o                      |
| Terminal 2              | GPIO 34 (ADC)              | Leitura anal√≥gica                |
| Terminal 2              | GND (via resistor 10kŒ©)    | Divisor de tens√£o                |
| **LED**                 |                            |                                  |
| √Çnodo (+)               | GPIO 2 (via resistor 330Œ©) | Controle do LED                  |
| C√°todo (-)              | GND                        | Terra                            |

#### üìù Arquivos do Projeto

Para fazer a simula√ß√£o do ESP32 use o Wokwi e copie os arquivos do circuito e c√≥digo est√£o na pasta `devices/` do reposit√≥rio:

- `sketch.ino` - C√≥digo do ESP32
- `diagram.json` - Configura√ß√£o do circuito Wokwi

Ou ent√£o entre no link:

- [**Circuito Wokwi**](https://wokwi.com/projects/444821783999289345)

#### ‚öôÔ∏è Configurar o C√≥digo

Abra o arquivo `sketch.ino` e **ajuste as seguintes linhas** com os dados da sua VM AWS:

```cpp
// Linha 17-19: Configura√ß√£o WiFi (j√° est√° configurado para Wokwi)
const char* SSID = "Wokwi-GUEST";
const char* PASSWORD = "";

// Linha 20: ALTERE para o IP p√∫blico da sua VM EC2
const char* BROKER_MQTT = "SEU_IP_DA_VM_AWS";

// Linha 21: Porta do MQTT Broker
const int BROKER_PORT = 1883;
```

#### üéØ T√≥picos MQTT Utilizados

| T√≥pico                   | Tipo      | Descri√ß√£o                    |
| ------------------------ | --------- | ---------------------------- |
| `/TEF/device001/cmd`     | Subscribe | Recebe comandos (LED ON/OFF) |
| `/TEF/device001/attrs`   | Publish   | Estado geral do dispositivo  |
| `/TEF/device001/attrs/s` | Publish   | Estado do LED (on/off)       |
| `/TEF/device001/attrs/l` | Publish   | Luminosidade (0-100%)        |
| `/TEF/device001/attrs/h` | Publish   | Umidade (%)                  |
| `/TEF/device001/attrs/t` | Publish   | Temperatura (¬∞C)             |

---

### Passo 2: Configurar a VM AWS

#### üì¶ 2.1 - Criar Inst√¢ncia EC2

1. Acesse o **AWS Console**
2. V√° para **EC2 > Launch Instance**
3. Escolha **Ubuntu Server 22.04 LTS**
4. Tipo: **t2.medium** ou superior (recomendado para FIWARE)
5. Configure o **Security Group** com as seguintes portas:

| Porta | Protocolo | Descri√ß√£o               |
| ----- | --------- | ----------------------- |
| 22    | TCP       | SSH                     |
| 1883  | TCP       | MQTT Broker (Mosquitto) |
| 1026  | TCP       | Orion Context Broker    |
| 4041  | TCP       | IoT Agent MQTT          |
| 8666  | TCP       | STH-Comet               |

#### üîó 2.2 - Conectar via SSH

```bash
ssh -i sua-chave.pem ubuntu@SEU_IP_PUBLICO
```

#### üì• 2.3 - Instalar Docker e Git

```bash
# Atualizar o sistema
sudo apt update && sudo apt upgrade -y

# Instalar Git
sudo apt install git -y

# Instalar Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# Adicionar usu√°rio ao grupo docker
sudo usermod -aG docker $USER

# Instalar Docker Compose
sudo apt install docker-compose -y

# Reiniciar a sess√£o para aplicar as permiss√µes
exit
# Conecte novamente via SSH
```

#### üê≥ 2.4 - Clonar e Executar o FIWARE

```bash
# Clonar o reposit√≥rio FIWARE Descomplicado
git clone https://github.com/fabiocabrini/fiware.git

# Entrar na pasta
cd fiware

# Subir os containers
sudo docker compose up -d

# Verificar se os containers est√£o rodando
sudo docker ps
```

**Containers esperados:**

- `fiware-orion`
- `fiware-sth-comet`
- `fiware-iot-agent`
- `fiware-mongo`
- `mosquitto-mqtt`

---

### Passo 3: Provisionar Dispositivos no FIWARE (Postman)

#### üì¨ 3.1 - Importar Collection no Postman

1. Baixe o arquivo de collection do reposit√≥rio **FIWARE Descomplicado**
2. Abra o **Postman**
3. Clique em **Import** e selecione o arquivo

#### ‚úÖ 3.2 - Health Check

Execute a requisi√ß√£o **Health Check** para verificar se o Orion est√° respondendo:

```
GET http://SEU_IP_AWS:1026/version
```

#### üì° 3.3 - Provisionar Dispositivo

Execute a requisi√ß√£o **Provisionar Dispositivo** (POST). Certifique-se de que o corpo da requisi√ß√£o cont√©m:

```json
{
  "devices": [
    {
      "device_id": "device001",
      "entity_name": "urn:ngsi-ld:Device:001",
      "entity_type": "Device",
      "protocol": "PDI-IoTA-UltraLight",
      "transport": "MQTT",
      "attributes": [
        { "object_id": "t", "name": "temperature", "type": "Float" },
        { "object_id": "h", "name": "humidity", "type": "Float" },
        { "object_id": "l", "name": "luminosity", "type": "Float" },
        { "object_id": "s", "name": "status", "type": "Text" }
      ],
      "commands": [
        { "name": "on", "type": "command" },
        { "name": "off", "type": "command" }
      ]
    }
  ]
}
```

#### üìù 3.4 - Registrar Comandos

Execute as requisi√ß√µes para registrar os comandos:

- **Registrar Comando ON**
- **Registrar Comando OFF**

#### üîî 3.5 - Subscrever √†s Mudan√ßas

Execute a requisi√ß√£o **Criar Subscription** para que o STH-Comet armazene os dados hist√≥ricos.

#### üß™ 3.6 - Testar Leitura de Dados

Com o **Wokwi rodando**, execute a requisi√ß√£o **GET - Luminosidade**:

```
GET http://SEU_IP_AWS:1026/v2/entities/urn:ngsi-ld:Device:001
```

**‚ö†Ô∏è IMPORTANTE**: Certifique-se de usar o `entity_name` e `entity_type` corretos conforme o provisionamento:

- **ID**: `urn:ngsi-ld:Device:001`
- **Type**: `Device`

Voc√™ deve receber os valores de temperatura, umidade, luminosidade e status do LED em tempo real.

---

### Passo 4: Configurar o Aplicativo MyMQTT

#### üì± 4.1 - Instalar o MyMQTT

- **Android**: [Play Store](https://play.google.com/store/apps/details?id=at.tripwire.mqtt.client)
- **iOS**: [App Store](https://apps.apple.com/app/mymqtt/id1529660475)

#### üîó 4.2 - Configurar Conex√£o

1. Abra o **MyMQTT**
2. Toque em **+** para adicionar nova conex√£o
3. Configure:
   - **Nome**: Adega FIWARE
   - **Host**: `SEU_IP_DA_VM_AWS`
   - **Porta**: `1883`
   - **Username**: (deixe vazio)
   - **Password**: (deixe vazio)
4. Toque em **Salvar** e depois em **Conectar**

#### üìä 4.3 - Subscrever aos T√≥picos

V√° para a aba **Subscribe** e adicione os seguintes t√≥picos:

| T√≥pico                   | O que voc√™ ver√°        |
| ------------------------ | ---------------------- |
| `/TEF/device001/attrs/t` | Temperatura em ¬∞C      |
| `/TEF/device001/attrs/h` | Umidade em %           |
| `/TEF/device001/attrs/l` | Luminosidade em %      |
| `/TEF/device001/attrs/s` | Estado do LED (on/off) |

#### üéõÔ∏è 4.4 - Controlar o LED

1. V√° para a aba **Publish**
2. Configure:
   - **Topic**: `/TEF/device001/cmd`
   - **Message**: `device001@on|` (para ligar) ou `device001@off|` (para desligar)
3. Toque em **Publish**

O LED no Wokwi deve responder imediatamente! üí°

---

## üìä Testando o Sistema Completo

### ‚úÖ Checklist de Verifica√ß√£o

- [ ] Containers Docker rodando na VM AWS
- [ ] Health Check do Orion respondendo corretamente
- [ ] Dispositivo provisionado no FIWARE
- [ ] Wokwi conectado ao broker MQTT
- [ ] MyMQTT recebendo dados dos sensores
- [ ] LED responde aos comandos do MyMQTT
- [ ] Postman consegue consultar dados via Orion

### üß™ Fluxo de Teste Completo

1. **Inicie a simula√ß√£o no Wokwi** ‚Üí Aguarde conex√£o WiFi e MQTT
2. **Abra o Serial Monitor no Wokwi** ‚Üí Verifique se os dados est√£o sendo publicados
3. **Abra o MyMQTT** ‚Üí Confirme que est√° recebendo temperatura, umidade e luminosidade
4. **No Postman, fa√ßa um GET** ‚Üí Verifique se o Orion tem os dados atualizados
5. **No MyMQTT, publique `device001@on|`** ‚Üí O LED deve acender
6. **No MyMQTT, publique `device001@off|`** ‚Üí O LED deve apagar

---

## üìö Estrutura do Reposit√≥rio

```
üì¶ projeto-adega-iot/
‚îú‚îÄ‚îÄ üìÅ devices/
‚îÇ   ‚îú‚îÄ‚îÄ sketch.ino          # C√≥digo do ESP32
‚îÇ   ‚îî‚îÄ‚îÄ diagram.json        # Configura√ß√£o do circuito Wokwi
‚îú‚îÄ‚îÄ üìÅ postman/
‚îÇ   ‚îî‚îÄ‚îÄ fiware-collection.json  # Collection do Postman
‚îú‚îÄ‚îÄ üìÑ README.md            # Este arquivo
‚îî‚îÄ‚îÄ üìÑ LICENSE
```

---

## üéØ Conceitos Aprendidos

- ‚úÖ Protocolo MQTT (Publish/Subscribe)
- ‚úÖ Arquitetura FIWARE para IoT
- ‚úÖ Provisionamento de dispositivos IoT
- ‚úÖ API REST (NGSI-v2)
- ‚úÖ Containeriza√ß√£o com Docker
- ‚úÖ Cloud Computing (AWS EC2)
- ‚úÖ Sensores e atuadores com ESP32
- ‚úÖ Comunica√ß√£o bidirecional IoT

---

## üìà Pr√≥ximas Melhorias

- [ ] Dashboard web com gr√°ficos em tempo real
- [ ] Alertas quando temperatura/umidade sa√≠rem da faixa ideal
- [ ] API REST personalizada para consulta de dados

---

## üë®‚Äçüíª Integrantes

**Ot√°vio Inaba - 565003**
GitHub: [Otaaviio](https://github.com/Otaaviio)
inkedIn: [Ot√°vio Inaba](www.linkedin.com/in/ot√°vio-inaba)

**Eduardo Ulisses - 566339**
GitHub: [UlissesE](https://github.com/UlissesE)
inkedIn: [Eduardo Ulisses](https://www.linkedin.com/in/eduardo-ulisses/)

**Eduardo Duran - 562017**
GitHub: [dudus70](https://github.com/dudus70)
inkedIn: [Eduardo Duran Del Ciel](https://www.linkedin.com/in/eduardo-duran-del-ciel-762862359/)

**Fernando Bellegarde - 564169**
GitHub: [fernandoBellegarde](https://github.com/fernandoBellegarde)
inkedIn: [Fernando Bellegarde](https://www.linkedin.com/in/fernandobellegarde/)

**Henrique Castro - 564560**
GitHub: [RickkCastro](https://github.com/RickkCastro)
inkedIn: [RickkCastro](https://www.linkedin.com/in/rickkcastro/)

**Henrique Guedes - 562474**
GitHub: [HenriGuedes](https://github.com/HenriGuedes)
inkedIn: [Henrique Guedes](https://www.linkedin.com/in/henrique-guedes-silv/)

---

## üìö Refer√™ncias

- [FIWARE Documentation](https://fiware.org/)
- [FIWARE Descomplicado](https://github.com/fabiocabrini/fiware)
- [ESP32 Documentation](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/)
- [Wokwi Simulator](https://wokwi.com/)
- [MQTT Protocol](https://mqtt.org/)
- [DHT22 Datasheet](https://www.sparkfun.com/datasheets/Sensors/Temperature/DHT22.pdf)
- [A LENDA ABSOLUTA](https://www.youtube.com/@lucasaugusto6019)

---

<div align="center">

### ‚≠ê Se este projeto foi √∫til, considere dar uma estrela!

**Feito com ‚ù§Ô∏è para a comunidade IoT**

üç∑ _"Tecnologia e vinhos: ambos melhoram com o tempo e o cuidado certo"_

</div>
